@inject ICategoryService categoryService
@inject IProductService ProductService
@inject ISyncLocalStorageService LocalStorage
@inject IStatsService StatsService

@page "/"
@page "/{categoryUrl}"
@if (category != null)
{
    <h1>WELCOME TO THE @category.Name SECTON </h1>
    <ProductList  />
}
else
{

    <AuthorizeView>
        <Authorized>
            <h1>Welcome back ,@LocalStorage.GetItemAsString("username") !</h1>
        </Authorized>
        <NotAuthorized>
            <h1>Welcome to blazing shop </h1>
        </NotAuthorized>
   

    </AuthorizeView>
    <ProductList />
}



@code 
{
    [Parameter]
    public string categoryUrl{ get; set; }
    private Category category = null;
    protected override async Task  OnParametersSetAsync()
    {
        await ProductService.LoadProducts(categoryUrl);
        if (categoryUrl != null)
        {
            category= categoryService.categories.FirstOrDefault( c => c.Url.ToLower().Equals(categoryUrl.ToLower()));

        }
        else
        {
            category = null; 
        }
        await StatsService.IncrementVisits();
        await StatsService.GetVisits();

    }
}